<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!----======== Navigation CSS ======== -->
    <link
      rel="stylesheet"
      href="{{url_for('static', filename='CSS/nav.css')}}"
    />

    <!-- Text content in Website -->
    <link
      rel="stylesheet"
      href="{{url_for('static', filename='CSS/Content.css')}}"
    />

    <!-- Dark Mode -->
    <link
      rel="stylesheet"
      href="{{url_for('static', filename='CSS/DarkMode.css')}}"
    />

    <!-- Loading Style -->
    <link
      rel="stylesheet"
      href="{{url_for('static', filename='CSS/Loader.css')}}"
    />

    <!----======== FAV Icon ======== -->
    <link
      rel="shortcut icon"
      href="{{url_for('static', filename='Images/Logo.jpg')}}"
      type="image/x-icon"
      style="border-radius: 50px"
    />

    <!----===== Boxicons CSS ===== -->
    <link
      href="https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css"
      rel="stylesheet"
    />

    <!-- BootStrap -->
    <link
      rel="stylesheet"
      href="	https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
    />

    {% block head %} {% endblock %}
  </head>
  <body id="body-pd">
    <!-- Header -->
    <header class="header" id="header">
      <div class="header_toggle">
        <!-- <i class="bx bx-menu" ></i> -->
        <i
          class="bx bx-menu-alt-left"
          id="header-toggle"
          onclick="Overflow()"
        ></i>
        {% block header %} {% endblock %}
      </div>
      <i
        class="bx bx-sun header_img"
        onclick="WebsiteModeToggle(),SendMode()"
      ></i>
    </header>

    <!-- NavBar -->
    <div class="l-navbar" id="nav-bar">
      <nav class="nav">
        <div>
          <a href="/" class="nav_logo">
            <i class="bx bx-layer nav_logo-icon"></i>
            <span class="nav_logo-name">KV Manager</span>
          </a>
          <div class="nav_list">
            <a href="/" class="nav_link">
              <i class="bx bx-grid-alt nav_icon"></i>
              <span class="nav_name">Home</span>
            </a>
            <a href="{{url_for('Events')}}" class="nav_link">
              <i class="bx bx-notification nav_icon"></i>
              <span class="nav_name">Events</span>
            </a>
            <a href="{{url_for('News')}}" class="nav_link">
              <i class="bx bx-news nav_icon"></i>
              <span class="nav_name">News</span>
            </a>
            <a href="{{url_for('Classwork')}}" class="nav_link">
              <i class="bx bx-bookmark nav_icon"></i>
              <span class="nav_name">Classwork</span>
            </a>
            <a href="{{url_for('Homework')}}" class="nav_link">
              <i class="bx bx-folder nav_icon"></i>
              <span class="nav_name">Homework</span>
            </a>
            <a href="{{url_for('T_Console')}}" class="nav_link">
              <i class="bx bx-bar-chart-alt-2 nav_icon"></i>
              <span class="nav_name">Teacher Console</span>
            </a>
          </div>
        </div>
        <a onclick="ConfirmLogout()" class="nav_link">
          <i class="bx bx-log-in nav_icon" id="Log-In-Out-Icon"></i>
          <span class="nav_name" id="Log-In-Out">Sign In</span>
        </a>
      </nav>
    </div>

    <!-- Loading Screen -->
    <div class="text Loader-Wrapper">
      <div class="lds-ring">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
      <div class="Loading-Text"><span id="LoadText"></span></div>
    </div>

    {% block Content%} {% endblock %}
    <!--Container Main end-->
  </body>
  <!-- Nav.js, Jquery AND Typed.js-->
  <script src="{{url_for('static', filename='JS/Nav.js')}}"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
  <script src="	https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
  <!----======== JS ======== -->
  {% block Script %}{% endblock %}

  <script>
    const ModeIcon = document.querySelector(".header_img");

    // Sending GET request to Server URL: UpdateMode
    // Server Returns the Previous Theme of the Body
    // If returns the Theme/class of the bady adding that class to body tag
    $.get({
      url: "{{url_for('UpdateMode')}}",
      // Data is getting recieved in string format
      success: function (data, status) {
        console.log(
          `Data Recived from UpdateMode : ${
            data != "" ? data : "No Data Recived"
          }\nStatus : ${status}`
        );

        // If the recieved data is not empty
        if (data != "") {
          // Adds the recieved data to the class of the BODY
          body.classList.add(data);

          ModeIcon.classList.remove("bx-sun");
          ModeIcon.classList.add("bx-moon");
          ModeIcon.style.color = "white";
        } else {
          ModeIcon.classList.remove("bx-moon");
          ModeIcon.classList.add("bx-sun");
          ModeIcon.removeAttribute("style");
        }
      },
    });

    // When the Toggle Mode button is clicked
    SendMode = () => {
      // List of the classes added to body
      let BodyClass = body.classList;

      // If the BODY'S class contains("dark")
      // Sends an ajax POST request to the sever with data = "dark"
      $.ajax({
        url: '{{url_for("UpdateMode")}}',
        type: "POST",
        data: BodyClass.contains("dark")
          ? JSON.stringify("dark")
          : JSON.stringify(""),
        contentType: "application/json",
        success: function (res) {
          console.log(res);
        },
        error: function (err) {
          console.log(err);
        },
      });
    };

    // Typing Animation on Loader
    let typed = new Typed("#LoadText", {
      strings: ["Hold ON !!", "Wait !!", "Loading..."],
      typeSpeed: 100,
      backSpeed: 100,
      loop: true,
    });

    // Fading Out of the Loader
    $(window).on("load", function () {
      $(".Loader-Wrapper").fadeOut("slow");
    });

    // Function that returns a bool true:(User has loged in) false:(Not loged in)
    LoginOrNot = () => {
      let a;
      // Sending a get request
      $.get({
        url: "{{url_for('LoginOrNot')}}",
        // async is false so that output can be returned
        async: false,
        success: function (data, status) {
          // Parsing the data retrived fromt he server
          let Loged = JSON.parse(data);
          a = Loged;
        },
      });
      return a;
    };

    // Login Variable store the info of the Login state
    // If User is Loged in True else false
    let Loged = LoginOrNot();

    // If User has Loged in changing the Login button and its icon to Logout
    if (Loged == true) {
      console.log(`Inside LoginOrNOt : ${Loged}`);
      // Login Icon in the sidebar
      const LogIcon = document.getElementById("Log-In-Out-Icon");
      // Login Text in the sidebar
      const LogText = document.getElementById("Log-In-Out");
      // Login Icon changes to Logout Icon
      LogIcon.classList.remove("bx-log-in");
      LogIcon.classList.add("bx-log-out");
      // Login Text Changes to Logout Text
      LogText.innerText = "Logout";
    }

    // Confirming beform loggin out
    // Redirects to the Login page if Confirmed
    ConfirmLogout = () => {
      if (Loged == true) {
        let UserInp = confirm("Do you want to Logout !!");
        if (UserInp == true) {
          window.location.replace("{{url_for('Login')}}");
        }
      } else {
        window.location.replace("/User_Admin_Login");
      }
    };

    /*===== LINK ACTIVE =====*/
    const linkColor = document.querySelectorAll(".nav_link");
    // Login button
    const Login = document.querySelector("#Log-In-Out");
    function colorLink() {
      url = window.location.href;
      // console.log(url);
      // console.log(url.indexOf("Login"));

      linkColor.forEach((l) => l.classList.remove("active"));
      if (
        url.indexOf("Login") != -1 ||
        url.indexOf("Signup") != -1 ||
        url.indexOf("Forgotpasswd") != -1 ||
        url.indexOf("ChangeCredentials") != -1
      ) {
        // console.log("Inside If");
        Login.classList.add("active");
      } else if (url.indexOf("{{url_for('Events')}}") != -1) {
        linkColor[1].classList.add("active");
      } else if (url.indexOf("{{url_for('News')}}") != -1) {
        linkColor[2].classList.add("active");
      } else if (url.indexOf("{{url_for('Classwork')}}") != -1) {
        linkColor[3].classList.add("active");
      } else if (url.indexOf("{{url_for('Homework')}}") != -1) {
        linkColor[4].classList.add("active");
      } else if (url.indexOf("{{url_for('T_Console')}}") != -1) {
        linkColor[5].classList.add("active");
      } else if (url.indexOf("{{url_for('Index')}}") != -1) {
        linkColor[0].classList.add("active");
      }
    }

    colorLink();
  </script>
</html>
